<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²½ê¸°ë„ ì‹¤ì‹œê°„ ë‚ ì”¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .select-container {
            position: relative;
            margin-bottom: 25px;
        }

        select {
            width: 100%;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            background: white;
            appearance: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #333;
        }

        select:hover {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .select-container::after {
            content: 'â–¼';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #667eea;
            font-size: 12px;
        }

        button {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .weather-info {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 20px;
            display: none;
            animation: slideUp 0.5s ease-out;
        }

        .weather-info.show {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .current-time {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .weather-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.5);
        }

        .temperature {
            font-size: 64px;
            font-weight: 700;
            color: #333;
            line-height: 1;
        }

        .temperature-unit {
            font-size: 32px;
            color: #666;
            vertical-align: top;
        }

        .weather-status {
            text-align: right;
        }

        .status-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .status-text {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .detail-item {
            background: rgba(255, 255, 255, 0.7);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .detail-item:hover {
            transform: scale(1.05);
        }

        .detail-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-value {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
            font-weight: 500;
        }

        .spinner {
            border: 4px solid rgba(102, 126, 234, 0.1);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            text-align: center;
            padding: 20px;
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
            border-radius: 12px;
            font-weight: 500;
        }

        @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
            }

            h1 {
                font-size: 24px;
            }

            .temperature {
                font-size: 48px;
            }

            .weather-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ¤ï¸ ê²½ê¸°ë„ ì‹¤ì‹œê°„ ë‚ ì”¨</h1>
        
        <div class="select-container">
            <select id="citySelect">
                <option value="">ì‹œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                <option value="60,121">ìˆ˜ì›ì‹œ</option>
                <option value="63,124">ì„±ë‚¨ì‹œ</option>
                <option value="57,128">ê³ ì–‘ì‹œ</option>
                <option value="65,119">ìš©ì¸ì‹œ</option>
                <option value="58,125">ë¶€ì²œì‹œ</option>
                <option value="59,123">ì•ˆì–‘ì‹œ</option>
                <option value="58,121">ì•ˆì‚°ì‹œ</option>
                <option value="61,130">ì˜ì •ë¶€ì‹œ</option>
                <option value="57,114">í‰íƒì‹œ</option>
                <option value="57,123">ì‹œí¥ì‹œ</option>
                <option value="59,128">êµ¬ë¦¬ì‹œ</option>
                <option value="62,123">ê´‘ëª…ì‹œ</option>
            </select>
        </div>

        <button id="getWeatherBtn" onclick="getWeather()">ë‚ ì”¨ ì¡°íšŒí•˜ê¸°</button>

        <div class="weather-info" id="weatherInfo">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
            </div>
        </div>
    </div>

    <script>
        // ê²½ê¸°ë„ ì£¼ìš” ì‹œì˜ ê²©ì ì¢Œí‘œ
        const cityCoordinates = {
            'ìˆ˜ì›ì‹œ': { nx: 60, ny: 121 },
            'ì„±ë‚¨ì‹œ': { nx: 63, ny: 124 },
            'ê³ ì–‘ì‹œ': { nx: 57, ny: 128 },
            'ìš©ì¸ì‹œ': { nx: 65, ny: 119 },
            'ë¶€ì²œì‹œ': { nx: 58, ny: 125 },
            'ì•ˆì–‘ì‹œ': { nx: 59, ny: 123 },
            'ì•ˆì‚°ì‹œ': { nx: 58, ny: 121 },
            'ì˜ì •ë¶€ì‹œ': { nx: 61, ny: 130 },
            'í‰íƒì‹œ': { nx: 57, ny: 114 },
            'ì‹œí¥ì‹œ': { nx: 57, ny: 123 },
            'êµ¬ë¦¬ì‹œ': { nx: 59, ny: 128 },
            'ê´‘ëª…ì‹œ': { nx: 62, ny: 123 }
        };

        const API_KEY = 'OaRLlfpKOXJH%2BFeghkAojoaSAQbb1bkFF9COvGfjixpiLkEYTHFLqIcBYqFb0HCrcX8H3A47X9QNiRpgcCXAOA%3D%3D';
        const BASE_URL = 'https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst';

        // í˜„ì¬ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ base_dateì™€ base_time ê³„ì‚°
        function getBaseDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hour = now.getHours();
            const minute = now.getMinutes();

            // ê¸°ìƒì²­ APIëŠ” 0200, 0500, 0800, 1100, 1400, 1700, 2000, 2300ì— ë°œí‘œ
            // í˜„ì¬ ì‹œê°„ë³´ë‹¤ ì´ì „ì˜ ê°€ì¥ ìµœê·¼ ë°œí‘œ ì‹œê°„ì„ ì°¾ìŒ
            const baseTimes = ['0200', '0500', '0800', '1100', '1400', '1700', '2000', '2300'];
            let baseTime = '0200';
            let baseDate = `${year}${month}${day}`;

            const currentTime = hour * 100 + (minute < 30 ? 0 : 30);
            
            for (let i = baseTimes.length - 1; i >= 0; i--) {
                const time = parseInt(baseTimes[i]);
                if (currentTime >= time) {
                    baseTime = baseTimes[i];
                    break;
                }
            }

            // ìì • ì´ì „ ì‹œê°„ì´ë©´ ì „ë‚ ë¡œ
            if (parseInt(baseTime) < 200 && hour < 2) {
                const yesterday = new Date(now);
                yesterday.setDate(yesterday.getDate() - 1);
                baseDate = `${yesterday.getFullYear()}${String(yesterday.getMonth() + 1).padStart(2, '0')}${String(yesterday.getDate()).padStart(2, '0')}`;
                baseTime = '2300';
            }

            return { baseDate, baseTime };
        }

        // ë‚ ì”¨ ìƒíƒœ ì•„ì´ì½˜ ë° í…ìŠ¤íŠ¸ ë³€í™˜
        function getWeatherStatus(sky, pty) {
            if (pty === '1' || pty === '2' || pty === '4') {
                return { icon: 'ğŸŒ§ï¸', text: 'ë¹„' };
            } else if (pty === '3') {
                return { icon: 'â„ï¸', text: 'ëˆˆ' };
            } else if (sky === '1') {
                return { icon: 'â˜€ï¸', text: 'ë§‘ìŒ' };
            } else if (sky === '3') {
                return { icon: 'â›…', text: 'êµ¬ë¦„ ë§ìŒ' };
            } else if (sky === '4') {
                return { icon: 'â˜ï¸', text: 'íë¦¼' };
            }
            return { icon: 'ğŸŒ¤ï¸', text: 'ì •ë³´ ì—†ìŒ' };
        }

        // í’í–¥ì„ ë°©ìœ„ë¡œ ë³€í™˜
        function getWindDirection(angle) {
            const directions = ['ë¶', 'ë¶ë™', 'ë™', 'ë™ë‚¨', 'ë‚¨', 'ë‚¨ì„œ', 'ì„œ', 'ë¶ì„œ'];
            const index = Math.round(angle / 45) % 8;
            return directions[index];
        }

        async function getWeather() {
            const citySelect = document.getElementById('citySelect');
            const weatherInfo = document.getElementById('weatherInfo');
            const getWeatherBtn = document.getElementById('getWeatherBtn');

            if (!citySelect.value) {
                alert('ì‹œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const [nx, ny] = citySelect.value.split(',');
            const { baseDate, baseTime } = getBaseDateTime();

            // UI ì—…ë°ì´íŠ¸
            getWeatherBtn.disabled = true;
            weatherInfo.classList.add('show');
            weatherInfo.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>
            `;

            const url = `${BASE_URL}?serviceKey=${API_KEY}&numOfRows=100&pageNo=1&dataType=JSON&base_date=${baseDate}&base_time=${baseTime}&nx=${nx}&ny=${ny}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.response?.header?.resultCode !== '00') {
                    throw new Error(data.response?.header?.resultMsg || 'API í˜¸ì¶œ ì‹¤íŒ¨');
                }

                const items = data.response.body.items.item;
                if (!items || items.length === 0) {
                    throw new Error('ë‚ ì”¨ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }

                // í˜„ì¬ ì‹œê°„ì— ê°€ì¥ ê°€ê¹Œìš´ ë°ì´í„° ì¶”ì¶œ
                const now = new Date();
                const currentHour = String(now.getHours()).padStart(2, '0');
                const currentMin = String(now.getMinutes()).padStart(2, '0');
                const currentTime = `${currentHour}${currentMin}`;

                // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë°ì´í„° ì •ë¦¬
                const weatherData = {};
                items.forEach(item => {
                    const fcstTime = item.fcstTime;
                    if (!weatherData[fcstTime]) {
                        weatherData[fcstTime] = {};
                    }
                    weatherData[fcstTime][item.category] = item.fcstValue;
                });

                // í˜„ì¬ ì‹œê°„ì— ê°€ì¥ ê°€ê¹Œìš´ ì‹œê°„ ì°¾ê¸°
                const times = Object.keys(weatherData).sort();
                let targetTime = times[0];
                for (const time of times) {
                    if (time <= currentTime) {
                        targetTime = time;
                    } else {
                        break;
                    }
                }

                const current = weatherData[targetTime];
                if (!current) {
                    throw new Error('í˜„ì¬ ì‹œê°„ì˜ ë‚ ì”¨ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                // ë‚ ì”¨ ì •ë³´ ì¶”ì¶œ
                const temperature = current.TMP || 'N/A';
                const humidity = current.REH || 'N/A';
                const sky = current.SKY || '1';
                const pty = current.PTY || '0';
                const windSpeed = current.WSD || '0';
                const windDirection = current.VEC ? getWindDirection(parseFloat(current.VEC)) : 'N/A';
                const precipitation = current.PCP || '0';

                const status = getWeatherStatus(sky, pty);
                const currentDateTime = new Date().toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                // UI ì—…ë°ì´íŠ¸
                weatherInfo.innerHTML = `
                    <div class="current-time">${currentDateTime}</div>
                    <div class="weather-main">
                        <div>
                            <div class="temperature">
                                ${temperature}<span class="temperature-unit">â„ƒ</span>
                            </div>
                        </div>
                        <div class="weather-status">
                            <div class="status-icon">${status.icon}</div>
                            <div class="status-text">${status.text}</div>
                        </div>
                    </div>
                    <div class="weather-details">
                        <div class="detail-item">
                            <div class="detail-label">ìŠµë„</div>
                            <div class="detail-value">${humidity}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">í’ì†</div>
                            <div class="detail-value">${windSpeed}m/s</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">í’í–¥</div>
                            <div class="detail-value">${windDirection}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ê°•ìˆ˜ëŸ‰</div>
                            <div class="detail-value">${precipitation === '0' || precipitation === 'ê°•ìˆ˜ì—†ìŒ' ? '0mm' : precipitation}</div>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('ë‚ ì”¨ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);
                weatherInfo.innerHTML = `
                    <div class="error">
                        âš ï¸ ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br>
                        ${error.message}
                    </div>
                `;
            } finally {
                getWeatherBtn.disabled = false;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.addEventListener('DOMContentLoaded', function() {
            const citySelect = document.getElementById('citySelect');
            citySelect.addEventListener('change', function() {
                const weatherInfo = document.getElementById('weatherInfo');
                weatherInfo.classList.remove('show');
            });
        });
    </script>
</body>
</html>
